generator client {
  provider = "prisma-client-js"
//   output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model admins {
    id       Int    @id @default(autoincrement())
    name     String
    staff_id String @unique
    password String

    complaints complaints[]
    maintenances maintenances[]
}

model users {
    id         Int    @id @default(autoincrement())
    name       String
    student_id String
    email      String @unique
    password   String

    rooms      user_rooms[]
    complaints complaints[]
    maintenances maintenances[]
    user_hostel_relation user_hostel_relation[]
}

model rooms {
    id       Int    @id @default(autoincrement())
    name     String
    max_size Int
    hostel   hostels @relation(fields: [hostel_id], references: [id])
    hostel_id Int

    userRooms user_rooms[]
    user_hostel_relation user_hostel_relation[]
}

model user_rooms {
    id     Int        @id @default(autoincrement())
    user   users       @relation(fields: [userId], references: [id])
    userId Int
    room   rooms       @relation(fields: [roomId], references: [id])
    roomId Int
    status room_status

    @@index([userId])
    @@index([roomId])
}

model maintenances {
    id         Int             @id @default(autoincrement())
    admin      admins           @relation(fields: [adminId], references: [id])
    adminId    Int
    user       users            @relation(fields: [userId], references: [id])
    userId     Int
    status     complaint_status
    title      String
    details    String
    reply      String
    created_at DateTime        @default(now())
    updated_at DateTime        @updatedAt

    @@index([adminId])
    @@index([userId])
}

model complaints {
    id         Int             @id @default(autoincrement())
    admin      admins           @relation(fields: [adminId], references: [id])
    adminId    Int
    user       users?            @relation(fields: [userId], references: [id])
    userId     Int?
    status     complaint_status
    title      String
    details    String
    reply      String
    created_at DateTime        @default(now())
    updated_at DateTime        @updatedAt

    @@index([adminId])
    @@index([userId])
}

// Enums
enum room_status {
    pending
    approved
    rejected
}

enum complaint_status {
    open
    resolved
}

model hostels {
    id       Int    @id @default(autoincrement())
    name     String

    user_hostel_relation user_hostel_relation[]
    rooms rooms[]
}

model user_hostel_relation {
    id       Int         @id @default(autoincrement())
    user     users       @relation(fields: [user_id], references: [id])
    user_id   Int
    hostel   hostels     @relation(fields: [hostel_id], references: [id])
    hostel_id Int
    room     rooms?      @relation(fields: [room_id], references: [id])
    room_id   Int?
    status   room_status @default(pending)

    @@index([user_id])
    @@index([hostel_id])
    @@index([room_id])
}