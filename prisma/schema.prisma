generator client {
  provider = "prisma-client-js"
//   output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model admins {
    id       Int    @id @default(autoincrement())
    name     String
    staff_id String @unique
    password String

    complaints complaints[]
    maintenances maintenances[]
    user_notifications user_notifications[]
    conversations conversations[]
}

model users {
    id         Int    @id @default(autoincrement())
    name       String
    student_id String
    email      String @unique
    password   String

    rooms      user_rooms[]
    complaints complaints[]
    maintenances maintenances[]
    user_hostel_relation user_hostel_relation[]
    user_notifications user_notifications[]
    conversations conversations[]
}

model rooms {
    id       Int    @id @default(autoincrement())
    name     String
    max_size Int
    hostel   hostels @relation(fields: [hostel_id], references: [id])
    hostel_id Int

    userRooms user_rooms[]
    user_hostel_relation user_hostel_relation[]
}

model user_rooms {
    id     Int        @id @default(autoincrement())
    user   users       @relation(fields: [userId], references: [id])
    userId Int
    room   rooms       @relation(fields: [roomId], references: [id])
    roomId Int
    status room_status

    @@index([userId])
    @@index([roomId])
}

model maintenances {
    id         Int             @id @default(autoincrement())
    admin      admins           @relation(fields: [adminId], references: [id])
    adminId    Int
    user       users            @relation(fields: [userId], references: [id])
    userId     Int
    status     complaint_status
    title      String
    details    String
    reply      String
    created_at DateTime        @default(now())
    updated_at DateTime        @updatedAt

    @@index([adminId])
    @@index([userId])
}

model complaints {
    id         Int             @id @default(autoincrement())
    admin      admins           @relation(fields: [adminId], references: [id])
    adminId    Int
    user       users?            @relation(fields: [userId], references: [id])
    userId     Int?
    status     complaint_status
    title      String
    details    String
    reply      String
    created_at DateTime        @default(now())
    updated_at DateTime        @updatedAt

    @@index([adminId])
    @@index([userId])
}

// Enums
enum room_status {
    pending
    approved
    rejected
}

enum complaint_status {
    open
    resolved
}

model hostels {
    id       Int    @id @default(autoincrement())
    name     String

    user_hostel_relation user_hostel_relation[]
    rooms rooms[]
}

model user_hostel_relation {
    id       Int         @id @default(autoincrement())
    user     users       @relation(fields: [user_id], references: [id])
    user_id   Int
    hostel   hostels     @relation(fields: [hostel_id], references: [id])
    hostel_id Int
    room     rooms?      @relation(fields: [room_id], references: [id])
    room_id   Int?
    status   room_status @default(pending)

    @@index([user_id])
    @@index([hostel_id])
    @@index([room_id])
}

model notifications {
    id          Int        @id @default(autoincrement())
    title       String
    message     String
    created_at  DateTime    @default(now())

    // Relations
    userNotifications user_notifications[]
}

model user_notifications {
    id             Int            @id @default(autoincrement())
    user           users?         @relation(fields: [user_id], references: [id])
    user_id        Int?
    admin          admins?        @relation(fields: [admin_id], references: [id])
    admin_id       Int?

    notification   notifications   @relation(fields: [notification_id], references: [id])
    notification_id Int

    is_read        Boolean        @default(false)
    read_at        DateTime?

    @@index([user_id])
    @@index([admin_id])
    @@index([notification_id])
}

model conversations {
    id          Int      @id @default(autoincrement())
    admin_id    Int
    user_id     Int
    created_at  DateTime @default(now())

    admin admins @relation(fields: [admin_id], references: [id])
    user  users  @relation(fields: [user_id], references: [id])
    messages messages[]
}

model messages {
    id              Int       @id @default(autoincrement())
    conversation_id Int
    sender_admin_id Int?
    sender_user_id  Int?
    content         String
    is_read         Boolean   @default(false)
    created_at      DateTime  @default(now())

    conversation conversations @relation(fields: [conversation_id], references: [id])
}